<div class="container BayesArabicFont">
  @if (product$ | async; as data) {
    @if (data.isLoading) {
      <!-- Skeleton Loading -->
      <div class="skeleton-product">
        <div class="skeleton-image"></div>
        <div class="skeleton-details">
          <div class="skeleton-title"></div>
          <div class="skeleton-price"></div>
          <div class="skeleton-description"></div>
        </div>
      </div>
    } @else {
      @if (data.product) {
        <div class="product-details">
          <!-- Product Gallery Section -->
          <app-product-image-slider 
            [images]="selectedVariation ? [selectedVariation.image] : data.product.images" 
            [productName]="data.product.name">
          </app-product-image-slider>

          <!-- Product Info Section -->
          <div class="product-info">
            <h1 class="product-title">{{ data.product.name }}</h1>
            <div class="product-price">{{ (selectedVariation?.price || data.product.price) }} AED</div>

            <!-- عرض صور الـ Variations -->
            @if (variations$ | async; as variations) {
              <div class="variation-options">
                <div class="variation-title">Available Colors:</div>
                <div class="variations-container">
                  @for (variation of variations; track variation.id) {
                    <div
                      class="variation-image"
                      [class.active]="selectedVariation?.id === variation.id"
                      (click)="selectVariation(variation)"
                    >
                      <img [src]="variation.image.src" [alt]="getVariationColor(variation)" />
                    </div>
                  }
                </div>
              </div>
            }

            <!-- المقاسات (اختياري) -->
            @if (data.product.attributes && data.product.attributes.length > 0) {
              @for (attr of data.product.attributes; track attr.name) {
                @if (attr.name.toLowerCase() === 'size') {
                  <div class="size-options">
                    <div class="size-title">Available Sizes:</div>
                    <div class="sizes-container">
                      @for (size of attr.options; track size) {
                        <div
                          class="size-box"
                          [class.active]="selectedSize === size"
                        >
                          {{ size }}
                        </div>
                      }
                    </div>
                  </div>
                }
              }
            }

            <button class="add-to-cart" (click)="addToCart()">Add to Cart</button>

            <div class="product-description">
              <h3>Product Description:</h3>
              <div [innerHTML]="data.product.description"></div>
            </div>
          </div>
        </div>
      } @else {
        <div class="no-product">Product not found</div>
      }
    }
  }
</div>