<form
  class="sm:p-10 my-2 sm:my-0 lg:border-r"
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
>
  <div class="flex flex-col gap-y-8">
    <!-- Contact -->
    <section>
      <div class="flex flex-col items-center">
        <p class="text-gray-400 text-sm text-center">Express checkout</p>

        <!-- Stripe -->
        <div class="pt-4 w-full text-center">
          <a
            [routerLink]=""
            class="bg-blue-400 block font-semibold w-full xl:w-[262px] lg:mx-auto py-3 text-center text-white rounded-lg cursor-pointer hover:bg-blue-500 transition-all duration-150 tracking-wider"
            >Stripe</a
          >
          <div class="flex items-center gap-4 pt-4 pb-7">
            <span class="flex-grow h-px bg-gray-400"></span>
            <span class="text-gray-400 text-sm">OR</span>
            <span class="flex-grow h-px bg-gray-400"></span>
          </div>
        </div>

        <!-- Contact with Email -->
        <div class="w-full flex items-center justify-between">
          <h2 class="font-semibold text-xl">
            Contact <span class="text-red-500 text-base">*</span>
          </h2>
          <a [routerLink]="" class="text-red-400 underline text-sm">Log in</a>
        </div>

        <!-- الاينبوت بتاع الايميل -->
        <div class="py-4 w-full">
          <input
            type="email"
            class="bg-white border w-full py-[14px] px-3 rounded-lg"
            placeholder="Email"
            formControlName="email"
            [class]="{
              'border-red-500': emailIsInvalid,
            }"
          />
        </div>
        @if (emailIsInvalid) {
        <p class="text-sm text-red-500 w-full -mt-2 mb-4">
          Please enter a valid email address.
        </p>
        }

        <div class="w-full flex gap-x-2 items-center">
          <input type="checkbox" class="w-4 h-6" />
          <span class="text-sm">Email me with news and offers</span>
        </div>
      </div>
    </section>

    <!-- Biling -->
    <section class="flex flex-col gap-y-4">
      <h2 class="font-semibold text-xl">
        Billing details
        <span class="text-red-500 text-base">*</span>
      </h2>
      <!-- Country Select -->
      <div>
        <p-select
          [options]="avaliableCountries()"
          optionLabel="country"
          optionValue="country"
          placeholder="Select a Country"
          class="bg-white w-full py-[14px] px-3 rounded-lg"
          formControlName="countrySelect"
        />
      </div>

      <!-- First and Last Name -->
      <div
        class="flex sm:flex-row flex-col items-start gap-y-4 sm:gap-y-0 sm:gap-x-2"
      >
        <div
          class="w-full relative"
          [class]="{
            'mb-5': firstNameIsInvalid || lastNameIsInvalid
          }"
        >
          <input
            type="text"
            class="bg-white border w-full py-[14px] px-3 rounded-lg"
            placeholder="First name"
            formControlName="firstName"
            [class]="{
              'border-red-500': firstNameIsInvalid,
            }"
          />

          @if (firstNameIsInvalid) {
          <p class="absolute text-sm text-red-500 w-full mt-1 left-0">
            Enter a first name
          </p>
          }
        </div>

        <div class="w-full relative">
          <input
            type="text"
            class="bg-white border w-full py-[14px] px-3 rounded-lg"
            placeholder="Last name"
            formControlName="lastName"
            [class]="{
              'border-red-500': lastNameIsInvalid,
            }"
          />

          @if (lastNameIsInvalid) {
          <p class="absolute text-sm text-red-500 w-full mt-1 left-0">
            Enter a last name
          </p>
          }
        </div>
      </div>

      <!-- Address -->
      <div>
        <input
          type="text"
          class="bg-white border w-full py-[14px] px-3 rounded-lg"
          placeholder="Address"
          formControlName="address"
          [class]="{
    'border-red-500': addressIsInvalid,
  }"
        />
        @if (addressIsInvalid) {
        <p class="text-sm text-red-500 w-full mt-1">Enter an address</p>
        }
      </div>

      <!-- Apartment -->
      <input
        type="text"
        class="bg-white border w-full py-[14px] px-3 rounded-lg"
        placeholder="Apartment, suite, etc. (optional)"
        formControlName="apartment"
      />

      <!-- City and State -->
      <div
        class="flex items-center gap-x-2"
        [class]="{
          'mb-5': stateIsInvalid || cityIsInvalid
        }"
      >
        <div class="w-full relative">
          <input
            type="text"
            class="bg-white border w-full py-[14px] px-3 rounded-lg"
            placeholder="City"
            formControlName="city"
            [class]="{
              'border-red-500': cityIsInvalid,
            }"
          />
          @if (cityIsInvalid) {
          <p class="absolute text-sm text-red-500 w-full mt-1 left-0">
            Enter a city
          </p>
          }
        </div>
        <div class="w-full relative">
          <input
            type="text"
            class="bg-white border w-full py-[14px] px-3 rounded-lg"
            placeholder="State"
            formControlName="state"
            [class]="{
              'border-red-500': stateIsInvalid,
            }"
          />

          @if (stateIsInvalid) {
          <p class="absolute text-sm text-red-500 w-full mt-1 left-0">
            Enter a state
          </p>
          }
        </div>
      </div>

      <!-- Postcode -->
      <div>
        <input
          type="number"
          class="bg-white border w-full py-[14px] px-3 rounded-lg [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [&]:moz-appearance-textfield"
          placeholder="Postcode / Zip"
          formControlName="postCode"
          [class]="{
          'border-red-500': postCodeIsInvalid,
        }"
        />
        @if (postCodeIsInvalid) {
        <p class="text-sm text-red-500 w-full mt-[6px]">Enter a Postcode</p>
        }
      </div>

      <!-- Phone -->
      <div class="w-full relative">
        <input
          type="number"
          class="bg-white border w-full py-[14px] px-3 rounded-lg [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [&]:moz-appearance-textfield"
          placeholder="Phone"
          formControlName="phone"
          [class]="{
            'border-red-500': phoneIsInvalid,
          }"
        />

        @if (phoneIsInvalid) {
        <p class="text-sm text-red-500 mt-2">Enter a valid phone</p>
        }
        <div class="absolute top-[50%] right-[3%] -translate-y-[48%]">
          <div class="relative group">
            <i class="pi pi-question-circle cursor-pointer text-gray-400"></i>
            <span
              class="absolute right-0 -top-[120%] hidden group-hover:block bg-gray-800 text-white text-sm py-1 px-2 rounded-md shadow-md whitespace-nowrap"
            >
              in case we need to contact you about your order
            </span>
          </div>
        </div>
      </div>

      <div class="w-full flex gap-x-2 items-center">
        <input type="checkbox" class="w-4 h-6" />
        <span class="text-sm">Save this information for next time </span>
      </div>
    </section>

    <!-- Payment -->
    <section>
      <h2 class="font-semibold text-xl">Payment</h2>
      <p class="text-sm text-gray-500 mt-1">
        All transactions are secure and encrypted.
      </p>

      <div class="bg-[#F4F4F4] mt-2 border rounded-lg">
        <!-- Credit Card -->
        <div>
          <div
            class="flex justify-between items-center bg-white rounded-t-lg p-4"
            [class]="{
              paymentOptionActive: paymentRadiosValue === 'creditCard',
              'mb-3': paymentRadiosValue === 'creditCard'
            }"
          >
            <div class="flex items-center gap-x-2">
              <input
                type="radio"
                id="credit-card"
                value="creditCard"
                formControlName="paymentMethod"
              />
              <label class="text-sm" for="credit-card">Credit card</label>
            </div>
            <div class="flex items-center gap-x-2">
              <img
                src="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/visa.sxIq5Dot.svg"
                alt=""
              />
              <img
                src="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/mastercard.1c4_lyMp.svg"
                alt=""
              />
            </div>
          </div>
          @if (paymentRadiosValue === 'creditCard') {
          <!-- حقول Stripe Elements المنفصلة -->
          <div class="flex flex-col gap-y-3 px-4 pb-4">
            <!-- Card Number -->
            <div
              #cardNumberElement
              class="bg-white border rounded-lg p-3"
            ></div>
            <!-- Expiration Date & CVC -->
            <div
              class="flex sm:flex-row flex-col items-center gap-y-4 sm:gap-y-0 sm:gap-x-2"
            >
              <div
                #cardExpiryElement
                class="bg-white border rounded-lg p-3 w-full"
              ></div>
              <div
                #cardCvcElement
                class="bg-white border rounded-lg p-3 w-full"
              ></div>
            </div>
          </div>
          }
        </div>

        <!-- COD -->
        <div>
          <!-- Option 2 -->
          <div
            class="flex justify-between items-center bg-white rounded-b-lg p-4"
            [class]="{
              paymentOptionActive: paymentRadiosValue === 'cod',
              'border-t': paymentRadiosValue !== 'cod'
            }"
          >
            <div class="flex items-center gap-x-2">
              <input
                type="radio"
                id="cod"
                value="cod"
                formControlName="paymentMethod"
              />
              <label class="text-sm" for="cod"> Cash on delivery </label>
            </div>
          </div>

          @if (paymentRadiosValue === 'cod') {
          <!-- COD Details -->
          <div class="px-3">
            <div class="mt-3">
              <p class="text-sm mb-3">
                Choose this option to pay in cash upon delivery. AED 20 service
                fee applies. Please have the exact amount ready. Available
                across the UAE.
              </p>
            </div>
          </div>
          }
        </div>
      </div>

      <!-- Pay Button -->
      <div class="mt-6 mb-12">
        <button
          [disabled]="form.invalid"
          (click)="paymentRadiosValue === 'creditCard' ? payNow() : onSubmit()"
          class="block font-semibold w-full lg:mx-auto py-3 text-center text-white rounded-lg transition-all duration-150"
          [ngClass]="
            form.invalid
              ? 'bg-gray-500 hover:bg-gray-500 cursor-default'
              : 'bg-orange-600 hover:bg-orange-700 cursor-pointer'
          "
        >
          @if (paymentRadiosValue === 'cod') { Complete order } @else { Pay now
          }
        </button>
      </div>
      <hr />

      <!-- Polices -->
      <div class="flex gap-x-4 mt-4">
        <a [routerLink]="" class="underline text-sm text-red-400"
          >Refund policy</a
        >
        <a [routerLink]="" class="underline text-sm text-red-400"
          >Privacy policy</a
        >
        <a [routerLink]="" class="underline text-sm text-red-400"
          >Terms of service</a
        >
      </div>
    </section>
  </div>
</form>
