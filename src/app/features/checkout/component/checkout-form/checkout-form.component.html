<form class="my-2 sm:my-0 w-full" [formGroup]="billingForm">
  <div class="flex lg:flex-row flex-col w-full">
    <div class="lg:w-[55%] lg:border-r">
      <div class="flex flex-col gap-y-8 lg:p-10 mb-5 lg:mb-0">
        <!-- Contact -->
        <section>
          <div class="flex flex-col items-center">
            <p class="text-gray-400 text-sm text-center">Express checkout</p>

            <!-- GPay & Apple Pay -->
            <div class="pt-4 w-full text-center">
              <!-- Google Pay Button -->
              <div #googlePayButtonElement class="mb-4 md:w-[262px] mx-auto"></div>

              <div class="flex items-center gap-4 pt-4 pb-7">
                <span class="flex-grow h-px bg-gray-400"></span>
                <span class="text-gray-400 text-sm">OR</span>
                <span class="flex-grow h-px bg-gray-400"></span>
              </div>
            </div>

            <!-- Contact with Email -->
            <div class="w-full flex items-center justify-between">
              <h2 class="font-semibold text-xl">
                Contact <span class="text-red-500 text-base">*</span>
              </h2>
              <a [routerLink]="" class="text-red-400 underline text-sm"
                >Log in</a
              >
            </div>

            <!-- الاينبوت بتاع الايميل -->
            <div class="py-4 w-full">
              <input
                type="email"
                class="bg-white border w-full py-[14px] px-3 rounded-lg"
                placeholder="Email"
                formControlName="email"
                [class]="{
                  'border-red-500': emailIsInvalid,
                }"
              />
            </div>
            @if (emailIsInvalid) {
            <p class="text-sm text-red-500 w-full -mt-2 mb-4">
              Please enter a valid email address.
            </p>
            }

            <div class="w-full flex gap-x-2 items-center">
              <input type="checkbox" class="w-4 h-6" />
              <span class="text-sm">Email me with news and offers</span>
            </div>
          </div>
        </section>

        <!-- Biling -->
        <section class="flex flex-col gap-y-4">
          <h2 class="font-semibold text-xl">
            Billing details
            <span class="text-red-500 text-base">*</span>
          </h2>
          <!-- Country Select -->
          <div>
            <p-select
              [options]="avaliableCountries()"
              optionLabel="country"
              optionValue="country"
              placeholder="Select a Country"
              class="bg-white w-full py-[6px] px-3 rounded-lg"
              formControlName="countrySelect"
            />
          </div>

          <!-- First and Last Name -->
          <div
            class="flex sm:flex-row flex-col items-start gap-y-4 sm:gap-y-0 sm:gap-x-2"
          >
            <div
              class="w-full relative"
              [class]="{
                'mb-5': firstNameIsInvalid || lastNameIsInvalid
              }"
            >
              <input
                type="text"
                class="bg-white border w-full py-[14px] px-3 rounded-lg"
                placeholder="First name"
                formControlName="firstName"
                [class]="{
                  'border-red-500': firstNameIsInvalid,
                }"
              />

              @if (firstNameIsInvalid) {
              <p class="absolute text-sm text-red-500 w-full mt-1 left-0">
                Enter a first name
              </p>
              }
            </div>

            <div class="w-full relative">
              <input
                type="text"
                class="bg-white border w-full py-[14px] px-3 rounded-lg"
                placeholder="Last name"
                formControlName="lastName"
                [class]="{
                  'border-red-500': lastNameIsInvalid,
                }"
              />

              @if (lastNameIsInvalid) {
              <p class="absolute text-sm text-red-500 w-full mt-1 left-0">
                Enter a last name
              </p>
              }
            </div>
          </div>

          <!-- Address -->
          <div>
            <input
              type="text"
              class="bg-white border w-full py-[14px] px-3 rounded-lg"
              placeholder="Address"
              formControlName="address"
              [class]="{
        'border-red-500': addressIsInvalid,
      }"
            />
            @if (addressIsInvalid) {
            <p class="text-sm text-red-500 w-full mt-1">Enter an address</p>
            }
          </div>

          <!-- Apartment -->
          <input
            type="text"
            class="bg-white border w-full py-[14px] px-3 rounded-lg"
            placeholder="Apartment, suite, etc. (optional)"
            formControlName="apartment"
          />

          <!-- City and State -->
          <div
            class="flex items-center gap-x-2"
            [class]="{
              'mb-5': stateIsInvalid || cityIsInvalid
            }"
          >
            <div class="w-full relative">
              <input
                type="text"
                class="bg-white border w-full py-[14px] px-3 rounded-lg"
                placeholder="City"
                formControlName="city"
                [class]="{
                  'border-red-500': cityIsInvalid,
                }"
              />
              @if (cityIsInvalid) {
              <p class="absolute text-sm text-red-500 w-full mt-1 left-0">
                Enter a city
              </p>
              }
            </div>
            <div class="w-full relative">
              <input
                type="text"
                class="bg-white border w-full py-[14px] px-3 rounded-lg"
                placeholder="State"
                formControlName="state"
                [class]="{
                  'border-red-500': stateIsInvalid,
                }"
              />

              @if (stateIsInvalid) {
              <p class="absolute text-sm text-red-500 w-full mt-1 left-0">
                Enter a state
              </p>
              }
            </div>
          </div>

          <!-- Postcode -->
          <div>
            <input
              type="number"
              class="bg-white border w-full py-[14px] px-3 rounded-lg [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [&]:moz-appearance-textfield"
              placeholder="Postcode / Zip"
              formControlName="postCode"
              [class]="{
              'border-red-500': postCodeIsInvalid,
            }"
            />
            @if (postCodeIsInvalid) {
            <p class="text-sm text-red-500 w-full mt-[6px]">Enter a Postcode</p>
            }
          </div>

          <!-- Phone -->
          <div class="w-full relative">
            <input
              type="number"
              class="bg-white border w-full py-[14px] px-3 rounded-lg [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [&]:moz-appearance-textfield"
              placeholder="Phone"
              formControlName="phone"
              [class]="{
                'border-red-500': phoneIsInvalid,
              }"
            />

            @if (phoneIsInvalid) {
            <p class="text-sm text-red-500 mt-2">Enter a valid phone</p>
            }
            <div class="absolute top-[50%] right-[3%] -translate-y-[48%]">
              <div class="relative group">
                <i
                  class="pi pi-question-circle cursor-pointer text-gray-400"
                ></i>
                <span
                  class="absolute right-0 -top-[120%] hidden group-hover:block bg-gray-800 text-white text-sm py-1 px-2 rounded-md shadow-md whitespace-nowrap"
                >
                  in case we need to contact you about your order
                </span>
              </div>
            </div>
          </div>
        </section>

        <!-- Payment -->
        <section>
          <h2 class="font-semibold text-xl">Payment</h2>
          <p class="text-sm text-gray-500 mt-1">
            All transactions are secure and encrypted.
          </p>

          <div class="bg-[#F4F4F4] mt-2 border rounded-lg">
            <!-- Google Pay -->
            <div>
              <div
                class="flex justify-between items-center bg-white rounded-t-lg p-4"
                [class]="{
                  paymentOptionActive: paymentRadiosValue === 'googlePay',
                  'mb-3': paymentRadiosValue === 'googlePay'
                }"
              >
                <div class="flex items-center gap-x-2">
                  <input
                    type="radio"
                    id="googlePay"
                    value="googlePay"
                    formControlName="paymentMethod"
                  />
                  <label class="text-sm" for="googlePay">Google Pay</label>
                </div>
                <div class="flex items-center gap-x-2">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="xMidYMid"
                    viewBox="0 0 56 22"
                    width="56"
                    height="22"
                    fill="none"
                  >
                    <path d="M18.1 8.512v5.222h-1.65v-13h4.366c.997 0 1.879.368 2.647 1.103.792.735 1.188 1.633 1.188 2.695 0 1.085-.396 1.995-1.188 2.73-.735.75-1.617 1.125-2.647 1.125H18.1v.125Zm0-5.915v4.08h2.77c.552 0 1.028-.206 1.43-.618.419-.412.628-.904.628-1.476 0-.56-.21-1.052-.628-1.477-.402-.412-.878-.618-1.43-.618h-2.77v.11Zm10.65 2.969c1.21 0 2.167.33 2.87.992.703.661 1.054 1.572 1.054 2.733v5.443h-1.576v-1.227h-.071c-.678 1.007-1.582 1.51-2.712 1.51-.963 0-1.77-.287-2.415-.86-.644-.573-.966-1.293-.966-2.16 0-.909.343-1.634 1.028-2.175.686-.54 1.601-.81 2.745-.81.975 0 1.78.179 2.416.537v-.374c0-.544-.228-1.007-.678-1.389-.45-.382-.995-.573-1.633-.573-.943 0-1.685.4-2.226 1.198l-1.454-.926c.796-1.168 1.99-1.751 3.58-1.75h.038Zm-2.116 6.437c0 .389.183.736.547 1.044.365.308.797.463 1.298.463.694 0 1.333-.258 1.917-.772.585-.515.877-1.124.877-1.828-.516-.41-1.245-.617-2.186-.617-.682 0-1.253.16-1.713.478-.46.32-.69.728-.69 1.224l-.05.008Zm15.275-6.188l-5.372 12.334h-1.702l1.994-4.347-3.533-7.987h1.793l2.548 6.158h.035l2.478-6.158h1.759Z" fill="#202124"/>
                    <path d="M14.465 9.328H7.378v2.86h4.037c-.191 1.815-1.713 2.82-4.037 2.82A4.442 4.442 0 0 1 3.71 12.82a4.442 4.442 0 0 1 3.669-2.186c.965 0 1.828.323 2.513.948l2.053-2.052C10.663 8.242 9.02 7.67 7.378 7.67c-2.995 0-5.524 2.437-5.524 5.15 0 2.711 2.53 5.148 5.524 5.148 4.598 0 5.755-3.207 5.755-5.47 0-1.064-.118-1.975-.118-1.975l-.55-.195Z" fill="#4285F4"/>
                    <path d="M7.378 17.968c-2.995 0-5.524-2.437-5.524-5.148 0-2.713 2.53-5.15 5.524-5.15 1.642 0 3.286.573 4.567 1.86l-2.054 2.053c-.685-.625-1.548-.948-2.513-.948A4.442 4.442 0 0 0 3.71 12.82a4.442 4.442 0 0 0 3.669 2.186c2.324 0 3.845-1.004 4.037-2.82H7.378v-2.86h7.087s.118.911.118 1.976c0 2.262-1.157 5.469-5.755 5.469l.55.198Z" fill="#34A853"/>
                    <path d="M3.246 10.635a4.442 4.442 0 0 1 4.132-2.965c1.642 0 3.286.573 4.567 1.86l-2.054 2.053c-.685-.625-1.549-.904-2.513-.904-.965 0-1.828.278-2.548.904l-1.584-.948Z" fill="#FABB05"/>
                    <path d="M7.378 7.67c1.642 0 3.286.573 4.567 1.86l-2.054 2.053c-.685-.625-1.548-.904-2.513-.904-.965 0-1.828.278-2.548.904l-1.584-.948a4.442 4.442 0 0 1 4.132-2.965Z" fill="#E94235"/>
                  </svg>
                </div>
              </div>

              @if (paymentRadiosValue === 'googlePay') {
                <div class="px-3 text-center py-4" @slideInOut>
                  <p class="text-sm mb-2">
                    Fast, secure checkout with Google Pay.
                  </p>
                  <p class="text-xs text-gray-500">
                    You'll be able to confirm your payment in the Google Pay interface.
                  </p>
                </div>
              }
            </div>

            <!-- Stripe Card -->
            <div>
              <div
                class="flex justify-between items-center bg-white p-4"
                [class]="{
                  paymentOptionActive: paymentRadiosValue === 'stripe',
                  'mb-3': paymentRadiosValue === 'stripe',
                  'border-t': paymentRadiosValue !== 'stripe'
                }"
              >
                <div class="flex items-center gap-x-2">
                  <input
                    type="radio"
                    id="stripe"
                    value="stripe"
                    formControlName="paymentMethod"
                  />
                  <label class="text-sm" for="stripe">Credit card</label>
                </div>
                <div class="flex items-center gap-x-2">
                  <img
                    src="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/visa.sxIq5Dot.svg"
                    alt=""
                  />
                  <img
                    src="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/mastercard.1c4_lyMp.svg"
                    alt=""
                  />
                </div>
              </div>

              <!-- حقول Stripe Elements المنفصلة -->
              <div
                class="flex flex-col gap-y-3 px-4 pb-4"
                [class]="{
                  block: paymentRadiosValue === 'stripe',
                  hidden: paymentRadiosValue !== 'stripe'
                }"
                @slideInOut
              >
                <!-- Card Number -->
                <div
                  #cardNumberElement
                  class="bg-white border rounded-lg p-3"
                ></div>
                <!-- Expiration Date & CVC -->
                <div
                  class="flex sm:flex-row flex-col items-center gap-y-4 sm:gap-y-0 sm:gap-x-2"
                >
                  <div
                    #cardExpiryElement
                    class="bg-white border rounded-lg p-3 w-full"
                  ></div>
                  <div
                    #cardCvcElement
                    class="bg-white border rounded-lg p-3 w-full"
                  ></div>
                </div>
              </div>
            </div>
            <!-- Tabby -->
            <div>
              <!-- Option 2 -->
              <div
                class="flex justify-between items-center bg-white p-4"
                [class]="{
                  paymentOptionActive: paymentRadiosValue === 'tabby',
                  'border-t': paymentRadiosValue !== 'tabby'
                }"
              >
                <div class="flex items-center gap-x-2">
                  <input
                    type="radio"
                    id="tabby"
                    value="tabby"
                    formControlName="paymentMethod"
                  />
                  <label class="text-sm" for="tabby"
                    >Pay in 4 with Tabby. No interest. No fees</label
                  >
                </div>
                <img
                  src="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/tabby.C7-15TZI.svg"
                  alt=""
                />
              </div>

              @if (paymentRadiosValue === 'tabby') {
              <!-- Tabby Details -->
              <div class="px-3" @slideInOut>
                <div class="flex flex-col items-center gap-y-6 mt-8">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="-252.3 356.1 163 80.9"
                    class="!w-[160px] !h-20 !text-gray-500 !block"
                  >
                    <path
                      fill="none"
                      stroke="currentColor"
                      stroke-miterlimit="10"
                      stroke-width="2"
                      d="M-108.9 404.1v30c0 1.1-.9 2-2 2H-231c-1.1 0-2-.9-2-2v-75c0-1.1.9-2 2-2h120.1c1.1 0 2 .9 2 2v37m-124.1-29h124.1"
                    ></path>
                    <circle
                      cx="-227.8"
                      cy="361.9"
                      r="1.8"
                      fill="currentColor"
                    ></circle>
                    <circle
                      cx="-222.2"
                      cy="361.9"
                      r="1.8"
                      fill="currentColor"
                    ></circle>
                    <circle
                      cx="-216.6"
                      cy="361.9"
                      r="1.8"
                      fill="currentColor"
                    ></circle>
                    <path
                      fill="none"
                      stroke="currentColor"
                      stroke-miterlimit="10"
                      stroke-width="2"
                      d="M-128.7 400.1H-92m-3.6-4.1 4 4.1-4 4.1"
                    ></path>
                  </svg>
                  <p class="text-sm w-[350px] text-center mb-3">
                    After clicking “Pay now”, you will be redirected to Pay in 4
                    with Tabby. No interest. No fees to complete your purchase
                    securely.
                  </p>
                </div>
              </div>
              }
            </div>
            <!-- COD -->
            <div @slideInOut>
              <!-- Option 2 -->
              <div
                class="flex justify-between items-center bg-white rounded-b-lg p-4"
                [class]="{
                  paymentOptionActive: paymentRadiosValue === 'cod',
                  'border-t': paymentRadiosValue !== 'cod'
                }"
              >
                <div class="flex items-center gap-x-2">
                  <input
                    type="radio"
                    id="cod"
                    value="cod"
                    formControlName="paymentMethod"
                  />
                  <label class="text-sm" for="cod"> Cash on delivery </label>
                </div>
              </div>

              @if (paymentRadiosValue === 'cod' ) {
              <!-- COD Details -->
              <div class="px-3" @slideInOut>
                <div class="mt-3">
                  <p class="text-sm mb-3">
                    Choose this option to pay in cash upon delivery. AED 20
                    service fee applies. Please have the exact amount ready.
                    Available across the UAE.
                  </p>
                </div>
              </div>
              }
            </div>
          </div>

          <!-- Shipping -->
          <div class="mt-4">
            <h2 class="font-semibold text-xl">Billing address</h2>

            <div class="bg-[#F4F4F4] mt-2 border rounded-lg">
              <!-- Same Address -->
              <div class="flex items-center gap-x-2 bg-white rounded-t-lg p-4">
                <input
                  type="radio"
                  id="same"
                  value="same"
                  formControlName="shippingMethod"
                />
                <label class="text-sm" for="same"
                  >Same as shipping address
                </label>
              </div>

              <!-- Different Address -->
              <div
                class="flex items-center gap-x-2 bg-white rounded-b-lg p-4"
                @slideInOut
              >
                <input
                  type="radio"
                  id="different"
                  value="different"
                  formControlName="shippingMethod"
                />
                <label class="text-sm" for="different">
                  Use a different billing address</label
                >
              </div>
            </div>
          </div>
          <!-- Shiiping Form -->
          @if (isShippingDifferent) {
          <form class="flex flex-col gap-y-4 mt-4" [formGroup]="shippingForm">
            <h2 class="font-semibold text-xl">
              Shipping details
              <span class="text-red-500 text-base">*</span>
            </h2>

            <!-- First and Last Name -->
            <div
              class="flex sm:flex-row flex-col items-start gap-y-4 sm:gap-y-0 sm:gap-x-2"
            >
              <input
                type="text"
                class="bg-white border w-full py-[14px] px-3 rounded-lg"
                placeholder="First name"
                formControlName="firstName"
              />

              <input
                type="text"
                class="bg-white border w-full py-[14px] px-3 rounded-lg"
                placeholder="Last name"
                formControlName="lastName"
              />
            </div>

            <!-- Country Select -->
            <div>
              <p-select
                [options]="avaliableCountries()"
                optionLabel="country"
                optionValue="country"
                placeholder="Select a Country"
                class="bg-white w-full py-[14px] px-3 rounded-lg"
                formControlName="countrySelect"
              />
            </div>

            <!-- Address -->
            <div>
              <input
                type="text"
                class="bg-white border w-full py-[14px] px-3 rounded-lg"
                placeholder="Address"
                formControlName="address"
              />
            </div>

            <!-- Apartment -->
            <input
              type="text"
              class="bg-white border w-full py-[14px] px-3 rounded-lg"
              placeholder="Apartment, suite, etc. (optional)"
              formControlName="apartment"
            />

            <!-- City and State -->
            <div class="flex items-center gap-x-2">
              <div class="w-full relative">
                <input
                  type="text"
                  class="bg-white border w-full py-[14px] px-3 rounded-lg"
                  placeholder="City"
                  formControlName="city"
                />
              </div>
              <div class="w-full relative">
                <input
                  type="text"
                  class="bg-white border w-full py-[14px] px-3 rounded-lg"
                  placeholder="State"
                  formControlName="state"
                />
              </div>
            </div>
          </form>
          }

          <!-- Pay Button -->
          <div class="mt-6 mb-12 lg:block hidden">
            <button
              [disabled]="!isFormValid()"
              (click)="paymentRadiosValue === 'stripe' ? payNow() : onSubmit()"
              class="block font-semibold w-full lg:mx-auto py-3 text-center text-white rounded-lg transition-all duration-150"
              [ngClass]="
                !isFormValid()
                  ? 'bg-gray-500 hover:bg-gray-500 cursor-default'
                  : 'bg-orange-600 hover:bg-orange-700 cursor-pointer'
              "
            >
              @if (isOrderLoading$ | async) {
              <div
                class="inline-block animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"
              ></div>
              }@else { @if (paymentRadiosValue === 'cod') { Complete order }
              @else { Pay now }}
            </button>
          </div>
          <hr />

          <!-- Polices -->
          <div class="lg:block hidden">
            <div class="flex gap-x-4 mt-4">
              <a [routerLink]="" class="underline text-sm text-red-400"
                >Refund policy</a
              >
              <a [routerLink]="" class="underline text-sm text-red-400"
                >Privacy policy</a
              >
              <a [routerLink]="" class="underline text-sm text-red-400"
                >Terms of service</a
              >
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Show Button -->
    <div class="flex justify-between items-center mb-4 lg:hidden">
      <p class="text-xl font-semibold">Order summary</p>

      <div
        class="flex items-center gap-x-2 text-orange-500 cursor-pointer"
        (click)="onShowSummary()"
      >
        <button>
          {{ !(summaryIsVisible$ | async) ? "Hide" : "Show" }}
        </button>
        <i class="pi pi-sort-down-fill"></i>
      </div>
    </div>

    <!-- Summary -->
    <div class="lg:w-[45%]">
      <app-checkout-summary [isVisible$]="summaryIsVisible$!">
        <div class="mt-6 mb-12 lg:hidden block">
          <button
            [disabled]="!isFormValid()"
            (click)="paymentRadiosValue === 'stripe' ? payNow() : onSubmit()"
            class="block font-semibold w-full lg:mx-auto py-3 text-center text-white rounded-lg transition-all duration-150"
            [ngClass]="
              !isFormValid()
                ? 'bg-gray-500 hover:bg-gray-500 cursor-default'
                : 'bg-orange-600 hover:bg-orange-700 cursor-pointer'
            "
          >
            @if (isOrderLoading$ | async) {
            <div
              class="inline-block animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"
            ></div>
            }@else { @if (paymentRadiosValue === 'cod') { Complete order } @else
            { Pay now }}
          </button>
        </div>
      </app-checkout-summary>
    </div>
  </div>
</form>
