<div class="lg:ml-24 xl:ml-36 p-8 text-[#4d4f3a] lg:max-w-[550px] flex flex-col gap-y-5 border sticky-summary">
  <h2 class="font-semibold text-xl">Order summary</h2>
  <hr />

  <p>Tax included, shipping and discounts calculated at checkout.</p>

  <!-- Coupon Input -->
  <div>
    <div class="flex gap-x-2 items-center mt-4">
      <input type="text" class="bg-white border w-full py-[14px] px-3 rounded-lg text-base font-semibold"
        placeholder="Discount code or gift card" [(ngModel)]="couponValue" #couponInput [disabled]="haveCoupon === true"
        [class]="{
            'bg-[#99a0b1]': haveCoupon ===true ,
            'text-black': haveCoupon ===true ,
          }" />

      <button class="px-3 py-[14px] bg-red-500 rounded-lg text-white font-semibold"
        (click)="haveCoupon === true ? onRemoveCoupon() : onApplyCoupon()" [disabled]="
          couponValue === '' || (cartStatus$ | async)?.sideCartLoading
        " [class]="{
          'bg-red-500': haveCoupon === true,
          'bg-gray-500': couponValue === '' ,
          'cursor-pointer': couponValue !== '',
          'bg-orange-500': haveCoupon === false && couponValue !=='',
        }">
        @if (isCouponLoading$ | async) {
        <div class="animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"></div>

        }@else {
        {{ haveCoupon === true ? "Remove" : "Apply" }}
        }
      </button>
    </div>

    @if ((appliedCouponStatus$ | async).error !== null) {
    <p class="mt-1 text-red-500 text-lg">
      {{ (appliedCouponStatus$ | async).error }}
    </p>

    } @if (isUsed$ | async) {
    <p class="mt-1 text-red-500 text-xl">coupon usage limit has been reached</p>
    }
  </div>

  <!-- Shipping calculation section -->


  @if (!(loadedCart$ | async)?.cartIsLoaded) {
  <!-- Loading state for total -->
  <div class="flex justify-between font-semibold">
    <p class="text-lg">Total:</p>
    <div class="w-24 h-6 bg-gray-200 animate-pulse rounded"></div>
  </div>
  } @else {
  <!-- Subtotal -->
  <div class="flex justify-between">
    <p class="text-base">Subtotal:</p>
    <p [innerHTML]="(loadedCart$ | async)?.userCart?.totals?.sub_total | currencySvg"></p>
  </div>

  <!-- Discount if coupon is applied -->
  @if (getDiscountAmount() > 0) {
  <div class="flex justify-between text-green-600">
    <p class="text-base">
      Discount:
      @if (getCouponCode()) {
      <span class="text-xs ml-1">({{ getCouponCode() }})</span>
      }
    </p>
    <div class="flex items-center">
      <p>-<span [innerHTML]="getDiscountAmount() | currencySvg"></span></p>
      @if (getCouponType() === 'percent' || getCouponType() === 'percentage') {
      <span class="ml-1">({{ getCouponType() === 'percent' ? '%' : 'Percentage' }})</span>
      }
    </div>
  </div>
  }

  <!-- Shipping fee if applicable -->
  @if (!isInternationalShipping) {
  <div class="flex justify-between">
    <p class="text-base">Shipping:</p>
    <p [innerHTML]="isFreeShipping ? 'Free' : (20 | currencySvg)"></p>
  </div>
  }

  <!-- Total -->
  <div class="flex justify-between font-semibold">
    <p class="text-lg">Total:</p>
    <p class="text-black">
      @if (isInternationalShipping) {
      Contact us for shipping quote
      } @else {
      <span [innerHTML]="calculateTotal() | currencySvg"></span>
      }
    </p>
  </div>
  }

  <div>
    <a routerLink="/checkout">
      <button
        class="bg-[#3BB45A] hover:bg-[#2a9e39] transition-colors duration-300 font-semibold text-white p-3 rounded-md w-full">
        <i class="pi pi-shopping-bag mr-2 "></i>
        <span>Checkout</span>
      </button>
    </a>

    <!-- Wallet payment buttons -->
    @if ((loadedCart$ | async)?.cartIsLoaded && ((loadedCart$ | async)?.userCart?.items?.length > 0)) {
    @if (showWalletPayment) {
    <div class="mt-4">
      <div class="mb-2 text-sm text-center">or pay with</div>
      <app-wallet-payment (paymentSucceeded)="onPaymentSuccess($event)" [shippingOptions]="getShippingOptions()">
      </app-wallet-payment>
    </div>
    }
    }

    <a [routerLink]="['']" class="cursor-pointer block mt-4 text-center text-orange-600 text-sm underline">Continue
      Shopping</a>
  </div>
</div>