@if (hasError) {
<!-- Error state -->
<div class="w-full py-12">
  <app-container>
    <div class="flex flex-col items-center justify-center text-center p-8">
      <i class="pi pi-exclamation-triangle text-[80px] text-red-500 mb-6"></i>
      <h1 class="text-2xl font-bold mb-4">There was a problem loading your cart</h1>
      <p class="text-gray-600 mb-6">We encountered an issue retrieving your cart items. Please try again or contact
        support if the problem persists.</p>
      <div class="flex gap-4">
        <button (click)="retryLoadCart()"
          class="bg-[#3bb54a] hover:bg-[#2a9e39] text-white font-bold py-2 px-6 rounded focus:outline-none">
          Try Again
        </button>
        <a routerLink="/"
          class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded focus:outline-none">
          Continue Shopping
        </a>
      </div>
    </div>
  </app-container>
</div>
} @else if (isLoading && !((loadedCart$ | async)?.cartIsLoaded)) {
<!-- Loading state -->
<div class="w-full py-12">
  <app-container>
    <div class="flex flex-col items-center justify-center p-8">
      <i class="pi pi-spin pi-spinner text-[#3bb54a] text-[80px] mb-6"></i>
      <h2 class="text-xl font-semibold">Loading your cart...</h2>
    </div>
  </app-container>
</div>
} @else {
<!-- Show checkout progress map immediately in a centered container -->
<div class="w-full">
  <app-checkout-progress-map [currentStep]="'cart'"></app-checkout-progress-map>
</div>

<app-container>
  @if ((loadedCart$ | async).cartIsLoaded && ((loadedCart$ | async).userCart?.items?.length === 0 || (loadedCart$ |
  async).userCart?.length === 0)) {
  <!-- Empty cart message -->
  <div class="w-full flex flex-col gap-y-5 justify-center items-center lg:pt-[200px] pt-[100px] pb-[200px] text-center">
    <i class="pi pi-shopping-cart text-[100px] md:text-[150px] text-gray-300 font-thin"></i>
    <p class="text-3xl md:text-5xl font-semibold">
      Your cart is currently empty.
    </p>
    <a class="block rounded-lg bg-[#3bb54a] font-semibold px-5 py-3 text-lg text-white transition duration-150 hover:bg-[#2a9e39] cursor-pointer"
      routerLink="/">Return to shop</a>
  </div>
  } @else {
  <!-- Show cart layout immediately -->
  <div class="flex flex-col lg:flex-row gap-y-10 w-full mt-10">
    <div class="w-full lg:w-[50%]">
      @if ((cartStatus$ | async)?.mainPageLoading) {
      <!-- Only show loading indicator for products -->
      <div class="p-4 flex justify-center items-center">
        <i class="pi pi-spin pi-spinner text-[#3bb54a] text-4xl"></i>
      </div>
      } @else {
      <app-cart-products />
      }
    </div>
    <div class="w-full lg:w-[50%]">
      <app-cart-checkout />
    </div>
  </div>
  }
</app-container>
}