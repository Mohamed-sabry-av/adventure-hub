<div class="addresses-content">
  <h2 class="text-2xl font-semibold mb-4">Addresses</h2>

  <div *ngIf="isLoading" class="loading p-4 text-center">
    <p>Loading your addresses...</p>
    <div class="mt-2 flex justify-center">
      <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-gray-800"></div>
    </div>
  </div>

  <div *ngIf="error" class="error-message p-4 bg-red-50 text-red-600 rounded mb-6">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="saveSuccess" class="success-message p-4 bg-green-50 text-green-600 rounded mb-6">
    <div class="flex items-center">
      <i class="pi pi-check-circle mr-2"></i>
      <p>Your address has been updated successfully!</p>
    </div>
  </div>

  <!-- Address List View -->
  <div *ngIf="!isLoading && !error && customerDetails && !editingBilling && !editingShipping" class="addresses-container">
    <p class="text-sm mb-4">The following addresses will be used on the checkout page by default.</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Billing Address -->
      <div class="address-card p-5 border rounded hover:shadow-md transition-shadow">
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-lg font-medium">Billing Address</h3>
          <button (click)="editBillingAddress()" class="edit-btn text-sm text-blue-600 hover:text-blue-800">Edit</button>
        </div>

        <div class="address-details">
          <p>{{ customerDetails.billing.first_name }} {{ customerDetails.billing.last_name }}</p>
          <p *ngIf="customerDetails.billing.company">{{ customerDetails.billing.company }}</p>
          <p>{{ formatAddress(customerDetails.billing) }}</p>
          <p *ngIf="customerDetails.billing.email">Email: {{ customerDetails.billing.email }}</p>
          <p *ngIf="customerDetails.billing.phone">Phone: {{ customerDetails.billing.phone }}</p>
        </div>
      </div>

      <!-- Shipping Address -->
      <div class="address-card p-5 border rounded hover:shadow-md transition-shadow">
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-lg font-medium">Shipping Address</h3>
          <button (click)="editShippingAddress()" class="edit-btn text-sm text-blue-600 hover:text-blue-800">Edit</button>
        </div>

        <div class="address-details">
          <p>{{ customerDetails.shipping.first_name }} {{ customerDetails.shipping.last_name }}</p>
          <p *ngIf="customerDetails.shipping.company">{{ customerDetails.shipping.company }}</p>
          <p>{{ formatAddress(customerDetails.shipping) }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Billing Address Edit Form -->
  <div *ngIf="editingBilling" class="edit-address-form">
    <div class="flex items-center mb-6">
      <button (click)="cancelEdit()" class="mr-4 p-2 rounded hover:bg-gray-100">
        <i class="pi pi-arrow-left"></i>
      </button>
      <h3 class="text-xl font-medium">Edit Billing Address</h3>
    </div>

    <form [formGroup]="billingForm" (ngSubmit)="saveBillingAddress()" class="address-form">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <!-- First Name -->
        <div class="form-group">
          <label for="billing_first_name" class="block text-sm font-medium mb-1">First Name *</label>
          <input
            type="text"
            id="billing_first_name"
            formControlName="first_name"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': billingForm.get('first_name')?.invalid && billingForm.get('first_name')?.touched}">
          <small *ngIf="billingForm.get('first_name')?.invalid && billingForm.get('first_name')?.touched" class="text-red-500">
            First name is required
          </small>
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label for="billing_last_name" class="block text-sm font-medium mb-1">Last Name *</label>
          <input
            type="text"
            id="billing_last_name"
            formControlName="last_name"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': billingForm.get('last_name')?.invalid && billingForm.get('last_name')?.touched}">
          <small *ngIf="billingForm.get('last_name')?.invalid && billingForm.get('last_name')?.touched" class="text-red-500">
            Last name is required
          </small>
        </div>

        <!-- Company -->
        <div class="form-group">
          <label for="billing_company" class="block text-sm font-medium mb-1">Company</label>
          <input
            type="text"
            id="billing_company"
            formControlName="company"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Country -->
        <div class="form-group">
          <label for="billing_country" class="block text-sm font-medium mb-1">Country *</label>
          <input
            type="text"
            id="billing_country"
            formControlName="country"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': billingForm.get('country')?.invalid && billingForm.get('country')?.touched}">
          <small *ngIf="billingForm.get('country')?.invalid && billingForm.get('country')?.touched" class="text-red-500">
            Country is required
          </small>
        </div>

        <!-- Address Line 1 -->
        <div class="form-group col-span-2">
          <label for="billing_address_1" class="block text-sm font-medium mb-1">Street Address *</label>
          <input
            type="text"
            id="billing_address_1"
            formControlName="address_1"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': billingForm.get('address_1')?.invalid && billingForm.get('address_1')?.touched}">
          <small *ngIf="billingForm.get('address_1')?.invalid && billingForm.get('address_1')?.touched" class="text-red-500">
            Street address is required
          </small>
        </div>

        <!-- Address Line 2 -->
        <div class="form-group col-span-2">
          <label for="billing_address_2" class="block text-sm font-medium mb-1">Apartment, suite, etc. (optional)</label>
          <input
            type="text"
            id="billing_address_2"
            formControlName="address_2"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- City -->
        <div class="form-group">
          <label for="billing_city" class="block text-sm font-medium mb-1">City *</label>
          <input
            type="text"
            id="billing_city"
            formControlName="city"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': billingForm.get('city')?.invalid && billingForm.get('city')?.touched}">
          <small *ngIf="billingForm.get('city')?.invalid && billingForm.get('city')?.touched" class="text-red-500">
            City is required
          </small>
        </div>

        <!-- State -->
        <div class="form-group">
          <label for="billing_state" class="block text-sm font-medium mb-1">State / Province *</label>
          <input
            type="text"
            id="billing_state"
            formControlName="state"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': billingForm.get('state')?.invalid && billingForm.get('state')?.touched}">
          <small *ngIf="billingForm.get('state')?.invalid && billingForm.get('state')?.touched" class="text-red-500">
            State is required
          </small>
        </div>

        <!-- Postcode -->
        <div class="form-group">
          <label for="billing_postcode" class="block text-sm font-medium mb-1">Postal Code *</label>
          <input
            type="text"
            id="billing_postcode"
            formControlName="postcode"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': billingForm.get('postcode')?.invalid && billingForm.get('postcode')?.touched}">
          <small *ngIf="billingForm.get('postcode')?.invalid && billingForm.get('postcode')?.touched" class="text-red-500">
            Postal code is required
          </small>
        </div>

        <!-- Phone -->
        <div class="form-group">
          <label for="billing_phone" class="block text-sm font-medium mb-1">Phone</label>
          <input
            type="tel"
            id="billing_phone"
            formControlName="phone"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="billing_email" class="block text-sm font-medium mb-1">Email</label>
          <input
            type="email"
            id="billing_email"
            formControlName="email"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': billingForm.get('email')?.errors?.['email'] && billingForm.get('email')?.touched}">
          <small *ngIf="billingForm.get('email')?.errors?.['email'] && billingForm.get('email')?.touched" class="text-red-500">
            Please enter a valid email
          </small>
        </div>
      </div>

      <div class="mt-6 flex">
        <button
          type="submit"
          [disabled]="billingForm.invalid || isSaving"
          class="px-6 py-2 bg-gray-800 text-white rounded hover:bg-gray-700 transition-colors"
          [ngClass]="{'opacity-50 cursor-not-allowed': billingForm.invalid || isSaving}">
          <i *ngIf="isSaving" class="pi pi-spinner pi-spin mr-2"></i>
          {{ isSaving ? 'Saving...' : 'Save Address' }}
        </button>
        <button
          type="button"
          (click)="cancelEdit()"
          class="ml-3 px-6 py-2 border rounded hover:bg-gray-100 transition-colors">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Shipping Address Edit Form -->
  <div *ngIf="editingShipping" class="edit-address-form">
    <div class="flex items-center mb-6">
      <button (click)="cancelEdit()" class="mr-4 p-2 rounded hover:bg-gray-100">
        <i class="pi pi-arrow-left"></i>
      </button>
      <h3 class="text-xl font-medium">Edit Shipping Address</h3>
    </div>

    <form [formGroup]="shippingForm" (ngSubmit)="saveShippingAddress()" class="address-form">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <!-- First Name -->
        <div class="form-group">
          <label for="shipping_first_name" class="block text-sm font-medium mb-1">First Name *</label>
          <input
            type="text"
            id="shipping_first_name"
            formControlName="first_name"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': shippingForm.get('first_name')?.invalid && shippingForm.get('first_name')?.touched}">
          <small *ngIf="shippingForm.get('first_name')?.invalid && shippingForm.get('first_name')?.touched" class="text-red-500">
            First name is required
          </small>
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label for="shipping_last_name" class="block text-sm font-medium mb-1">Last Name *</label>
          <input
            type="text"
            id="shipping_last_name"
            formControlName="last_name"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': shippingForm.get('last_name')?.invalid && shippingForm.get('last_name')?.touched}">
          <small *ngIf="shippingForm.get('last_name')?.invalid && shippingForm.get('last_name')?.touched" class="text-red-500">
            Last name is required
          </small>
        </div>

        <!-- Company -->
        <div class="form-group">
          <label for="shipping_company" class="block text-sm font-medium mb-1">Company</label>
          <input
            type="text"
            id="shipping_company"
            formControlName="company"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Country -->
        <div class="form-group">
          <label for="shipping_country" class="block text-sm font-medium mb-1">Country *</label>
          <input
            type="text"
            id="shipping_country"
            formControlName="country"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': shippingForm.get('country')?.invalid && shippingForm.get('country')?.touched}">
          <small *ngIf="shippingForm.get('country')?.invalid && shippingForm.get('country')?.touched" class="text-red-500">
            Country is required
          </small>
        </div>

        <!-- Address Line 1 -->
        <div class="form-group col-span-2">
          <label for="shipping_address_1" class="block text-sm font-medium mb-1">Street Address *</label>
          <input
            type="text"
            id="shipping_address_1"
            formControlName="address_1"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': shippingForm.get('address_1')?.invalid && shippingForm.get('address_1')?.touched}">
          <small *ngIf="shippingForm.get('address_1')?.invalid && shippingForm.get('address_1')?.touched" class="text-red-500">
            Street address is required
          </small>
        </div>

        <!-- Address Line 2 -->
        <div class="form-group col-span-2">
          <label for="shipping_address_2" class="block text-sm font-medium mb-1">Apartment, suite, etc. (optional)</label>
          <input
            type="text"
            id="shipping_address_2"
            formControlName="address_2"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- City -->
        <div class="form-group">
          <label for="shipping_city" class="block text-sm font-medium mb-1">City *</label>
          <input
            type="text"
            id="shipping_city"
            formControlName="city"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': shippingForm.get('city')?.invalid && shippingForm.get('city')?.touched}">
          <small *ngIf="shippingForm.get('city')?.invalid && shippingForm.get('city')?.touched" class="text-red-500">
            City is required
          </small>
        </div>

        <!-- State -->
        <div class="form-group">
          <label for="shipping_state" class="block text-sm font-medium mb-1">State / Province *</label>
          <input
            type="text"
            id="shipping_state"
            formControlName="state"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': shippingForm.get('state')?.invalid && shippingForm.get('state')?.touched}">
          <small *ngIf="shippingForm.get('state')?.invalid && shippingForm.get('state')?.touched" class="text-red-500">
            State is required
          </small>
        </div>

        <!-- Postcode -->
        <div class="form-group">
          <label for="shipping_postcode" class="block text-sm font-medium mb-1">Postal Code *</label>
          <input
            type="text"
            id="shipping_postcode"
            formControlName="postcode"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': shippingForm.get('postcode')?.invalid && shippingForm.get('postcode')?.touched}">
          <small *ngIf="shippingForm.get('postcode')?.invalid && shippingForm.get('postcode')?.touched" class="text-red-500">
            Postal code is required
          </small>
        </div>
      </div>

      <div class="mt-6 flex">
        <button
          type="submit"
          [disabled]="shippingForm.invalid || isSaving"
          class="px-6 py-2 bg-gray-800 text-white rounded hover:bg-gray-700 transition-colors"
          [ngClass]="{'opacity-50 cursor-not-allowed': shippingForm.invalid || isSaving}">
          <i *ngIf="isSaving" class="pi pi-spinner pi-spin mr-2"></i>
          {{ isSaving ? 'Saving...' : 'Save Address' }}
        </button>
        <button
          type="button"
          (click)="cancelEdit()"
          class="ml-3 px-6 py-2 border rounded hover:bg-gray-100 transition-colors">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
