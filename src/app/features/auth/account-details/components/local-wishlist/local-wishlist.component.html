<div class="wishlist-container">
    <h2 class="text-2xl font-bold mb-6">My Wishlist</h2>

    <!-- Cart Loading State -->
    <div *ngIf="uiService.cartStatus$ | async as cartStatus">
        <div *ngIf="cartStatus.sideCartLoading"
            class="cart-loading fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 z-50 flex justify-center items-center">
            <div class="bg-white p-4 rounded shadow-lg text-center">
                <div class="spinner mx-auto mb-2"></div>
                <p>Loading cart...</p>
            </div>
        </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="isLoading" class="loading p-4 text-center">
        <p>Loading your wishlist...</p>
        <div class="mt-2 flex justify-center">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Error state -->
    <div *ngIf="error && !isLoading" class="error-message p-4 bg-red-50 text-red-600 rounded mb-6">
        <p>{{ error }}</p>
    </div>

    <!-- Empty state -->
    <div *ngIf="isEmpty && !isLoading && !error" class="no-wishlist-items text-center py-8">
        <div class="mb-4">
            <i class="pi pi-heart-fill text-4xl text-gray-300"></i>
        </div>
        <h3 class="text-xl font-medium mb-2">Your wishlist is empty</h3>
        <p class="text-gray-600 mb-4">Browse our products and add items to your wishlist</p>
        <a routerLink="/shop"
            class="shop-button inline-block mt-4 px-6 py-2 bg-gray-800 text-white rounded hover:bg-gray-700 transition-colors">
            Browse Products
        </a>
    </div>

    <!-- Wishlist items -->
    <div *ngIf="!isEmpty && !isLoading" class="wishlist-grid">
        <div *ngFor="let item of wishlistItems; let i = index" class="wishlist-item">
            <!-- Removing overlay -->
            <div *ngIf="item.isRemoving" class="removing-overlay">
                <div class="spinner"></div>
                <p>Removing...</p>
            </div>

            <div class="product-card">
                <!-- Product image -->
                <div class="product-image mb-3">
                    <img [src]="getProductImage(item)" [alt]="getProductName(item)" class="w-full h-full"
                        loading="lazy" />
                </div>

                <!-- Product info -->
                <div class="product-info">
                    <h3 class="text-lg font-medium mb-2">{{ getProductName(item) }}</h3>
                    <div class="price">
                        <span class="current-price regular-price"
                            [innerHTML]="getProductPrice(item) | currencySvg"></span>
                    </div>

                    <!-- Added to cart notification -->
                    <div *ngIf="item.addedToCart" class="text-green-600 text-sm mb-3">
                        <i class="pi pi-check"></i> Added to cart
                    </div>

                    <div class="flex space-x-2">
                        <a [routerLink]="['/product', item.slug || item.id]" class="view-btn">
                            <i class="pi pi-eye mr-1"></i> View
                        </a>

                        <button class="add-to-cart-btn" (click)="addToCart(item, i)"
                            [disabled]="(uiService.spinnerLoading$ | async) || item.isAddingToCart">
                            <i class="pi" [ngClass]="{
                                'pi-shopping-cart mr-1': !(uiService.spinnerLoading$ | async) && !item.isAddingToCart,
                                'pi-spinner pi-spin': (uiService.spinnerLoading$ | async) || item.isAddingToCart
                            }"></i>
                            <span>Add to Cart</span>
                        </button>
                    </div>

                    <!-- Remove button -->
                    <button class="remove-btn mt-2" (click)="removeFromWishlist(item, i)" [disabled]="item.isRemoving">
                        <i class="pi pi-trash mr-1"></i> Remove
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>