<div class="payment-methods-content">
  <h2 class="text-2xl font-semibold mb-4">Payment Methods</h2>

  <div *ngIf="isLoading" class="loading p-4 text-center">
    <p>Loading your payment methods...</p>
    <div class="mt-2 flex justify-center">
      <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-gray-800"></div>
    </div>
  </div>

  <div *ngIf="error" class="error-message p-4 bg-red-50 text-red-600 rounded">
    <p>{{ error }}</p>
  </div>

  <!-- Payment methods list view -->
  <div *ngIf="!isLoading && !error && !selectedPaymentMethod">
    <p class="text-sm mb-6">The following payment methods are available on your account.</p>

    <div *ngIf="paymentGateways && paymentGateways.length > 0" class="payment-methods-grid grid grid-cols-1 md:grid-cols-2 gap-6">
      <div *ngFor="let gateway of paymentGateways" class="payment-method-card p-5 border rounded hover:shadow-md transition-shadow">
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-lg font-medium">{{ gateway.title }}</h3>
          <div class="payment-method-icon">
            <i class="pi" [ngClass]="getPaymentMethodIcon(gateway.id)"></i>
          </div>
        </div>
        <p class="text-gray-500 mb-4" [innerHTML]="gateway.description"></p>

        <button (click)="selectPaymentMethod(gateway)" class="manage-btn inline-block px-4 py-2 bg-gray-100 rounded hover:bg-gray-200 transition-colors">
          Manage
        </button>
      </div>
    </div>

    <div *ngIf="paymentGateways && paymentGateways.length === 0" class="no-payment-methods text-center py-8">
      <div class="mb-4">
        <i class="pi pi-credit-card text-4xl text-gray-300"></i>
      </div>
      <p class="text-gray-600">No payment methods are currently available.</p>
    </div>
  </div>

  <!-- Payment method edit view -->
  <div *ngIf="!isLoading && !error && selectedPaymentMethod" class="payment-method-edit">
    <div class="flex items-center mb-6">
      <button (click)="cancelEdit()" class="mr-4 p-2 rounded hover:bg-gray-100">
        <i class="pi pi-arrow-left"></i>
      </button>
      <h3 class="text-xl font-medium">{{ selectedPaymentMethod.title }}</h3>
    </div>

    <!-- Save success message -->
    <div *ngIf="saveSuccess" class="success-message p-4 bg-green-50 text-green-600 rounded mb-6">
      <div class="flex items-center">
        <i class="pi pi-check-circle mr-2"></i>
        <p>Payment method has been saved successfully!</p>
      </div>
    </div>

    <!-- Payment form -->
    <form [formGroup]="paymentForm" (ngSubmit)="savePaymentMethod()" class="payment-form">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <!-- Card Holder -->
        <div class="form-group col-span-2">
          <label for="card_holder" class="block text-sm font-medium mb-1">Card Holder Name</label>
          <input
            type="text"
            id="card_holder"
            formControlName="card_holder"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': paymentForm.get('card_holder')?.invalid && paymentForm.get('card_holder')?.touched}"
            placeholder="John Doe">
          <small *ngIf="paymentForm.get('card_holder')?.invalid && paymentForm.get('card_holder')?.touched" class="text-red-500">
            Card holder name is required
          </small>
        </div>

        <!-- Card Number -->
        <div class="form-group col-span-2">
          <label for="card_number" class="block text-sm font-medium mb-1">Card Number</label>
          <input
            type="text"
            id="card_number"
            formControlName="card_number"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': paymentForm.get('card_number')?.invalid && paymentForm.get('card_number')?.touched}"
            placeholder="1234 5678 9012 3456">
          <small *ngIf="paymentForm.get('card_number')?.invalid && paymentForm.get('card_number')?.touched" class="text-red-500">
            Please enter a valid 16-digit card number
          </small>
        </div>

        <!-- Expiry Month -->
        <div class="form-group">
          <label for="expiry_month" class="block text-sm font-medium mb-1">Expiry Month (MM)</label>
          <input
            type="text"
            id="expiry_month"
            formControlName="expiry_month"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': paymentForm.get('expiry_month')?.invalid && paymentForm.get('expiry_month')?.touched}"
            placeholder="MM">
          <small *ngIf="paymentForm.get('expiry_month')?.invalid && paymentForm.get('expiry_month')?.touched" class="text-red-500">
            Enter a valid month (01-12)
          </small>
        </div>

        <!-- Expiry Year -->
        <div class="form-group">
          <label for="expiry_year" class="block text-sm font-medium mb-1">Expiry Year (YYYY)</label>
          <input
            type="text"
            id="expiry_year"
            formControlName="expiry_year"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': paymentForm.get('expiry_year')?.invalid && paymentForm.get('expiry_year')?.touched}"
            placeholder="YYYY">
          <small *ngIf="paymentForm.get('expiry_year')?.invalid && paymentForm.get('expiry_year')?.touched" class="text-red-500">
            Enter a valid 4-digit year
          </small>
        </div>

        <!-- CVV -->
        <div class="form-group col-span-2 md:col-span-1">
          <label for="cvv" class="block text-sm font-medium mb-1">CVV</label>
          <input
            type="text"
            id="cvv"
            formControlName="cvv"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{'border-red-500': paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched}"
            placeholder="123">
          <small *ngIf="paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched" class="text-red-500">
            Enter a valid CVV code
          </small>
        </div>
      </div>

      <div class="mt-6">
        <button
          type="submit"
          [disabled]="paymentForm.invalid || isSaving"
          class="px-6 py-2 bg-gray-800 text-white rounded hover:bg-gray-700 transition-colors"
          [ngClass]="{'opacity-50 cursor-not-allowed': paymentForm.invalid || isSaving}">
          <i *ngIf="isSaving" class="pi pi-spinner pi-spin mr-2"></i>
          {{ isSaving ? 'Saving...' : 'Save Payment Method' }}
        </button>
        <button
          type="button"
          (click)="cancelEdit()"
          class="ml-3 px-6 py-2 border rounded hover:bg-gray-100 transition-colors">
          Cancel
        </button>
      </div>
    </form>

    <div class="security-notice mt-8 p-4 bg-gray-50 rounded">
      <div class="flex items-start">
        <i class="pi pi-lock mt-1 mr-2 text-gray-600"></i>
        <div>
          <p class="text-sm font-medium mb-1">Security Notice</p>
          <p class="text-xs text-gray-500">
            Your card information is securely processed and stored in compliance with PCI DSS standards.
            Your card details are never stored on our servers.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
