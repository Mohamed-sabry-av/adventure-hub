<!-- Header with sticky positioning instead of fixed -->
<header class="w-full header-container" [ngClass]="{
    'is-scroll': lastScrollY() > 0 && !isProductPage,
    'non-sticky': isProductPage || currentPage === 'checkout',
    'fullscreen-hidden': isFullScreenMode
  }" #headerEl [style.position]="isProductPage ? 'static' : 'sticky'">
  @if (currentPage === 'checkout') {
  <!-- Simplified Checkout Header -->
  <div class="checkout-header flex items-center justify-between px-4 py-3 bg-[#222222]">
    <!-- Empty div for left side spacing -->
    <div class="w-[36px]"></div>

    <!-- Centered logo -->
    <a class="block mx-auto">
      <img src="header/White logo-01.png" alt="Adventures hub logo" routerLink=""
        class="w-[140px] h-7 md:w-[200px] md:h-10 cursor-pointer" width="200" height="40" loading="lazy" />
    </a>

    <!-- Cart icon on right -->
    <div class="flex items-center">
      <a routerLink="/cart" class="icon-container">
        <i class="pi pi-shopping-bag"></i>
        <span *ngIf="cartCount > 0" class="count-badge">{{ cartCount }}</span>
      </a>
    </div>
  </div>
  } @else if(currentPage !== 'checkout') {
  <!-- Header content wrapper to maintain stable height -->
  <div class="header-content-wrapper">
    <!-- Layer 1: Top Info Banner - Only visible at the top of the page -->
    <div class="header-top-layer" [class.header-layer-hidden]="lastScrollY() > 0"
      [@layerAnimation]="lastScrollY() > 0 ? 'hidden' : 'visible'"
      [ngClass]="{'pointer-events-auto': lastScrollY() === 0, 'pointer-events-none': lastScrollY() > 0}">
      <div class="top-info-banner">
        <p class="absolute top-0 w-full text-center text-sm animate-slide-first">
          <strong>Free Delivery</strong> for orders over AED 100
        </p>
        <p class="absolute top-0 w-full text-center text-sm animate-slide-second">
          Buy Now & Pay Later with <strong>Tabby</strong>
        </p>
      </div>
    </div>

    <!-- Layer 2: Middle - Logo, Search, Icons (always visible) -->
    <div class="header-middle-layer" [class.header-middle-compact]="lastScrollY() > 10">
      <app-container>
        <div class="py-2 flex items-center justify-between relative">
          <!-- Menu icon and Search icon with improved click areas -->
          <div class="z-10 flex items-center gap-2">
            <!-- Menu icon with larger touch area -->
            <button class="icon-btn p-2 mobile-only" (click)="onSiwtchSideNav(true)">
              <i class="pi pi-bars text-xl"></i>
            </button>

            <!-- Search icon with larger touch area (search) -->
            <button *ngIf="!showSearchbar()" class="icon-btn p-2 ml-2 mobile-only" (click)="onShowSearchbar()">
              <i class="pi pi-search text-xl lg:hidden block"></i>
            </button>

            <!-- Close search icon with larger touch area (X) -->
            <button *ngIf="showSearchbar()" class="icon-btn p-2 ml-2 mobile-only" (click)="onShowSearchbar()">
              <i class="pi pi-times text-xl lg:hidden block"></i>
            </button>
          </div>

          <!-- Logo - Centered on mobile -->
          <a class="block absolute left-1/2 transform -translate-x-1/2 lg:static lg:transform-none">
            <img loading="lazy" src="header/White logo-01.png" alt="Adventures hub logo" routerLink=""
              class="w-[180px] h-9 lg:w-[250px] lg:h-12 cursor-pointer" width="250" height="48" />
          </a>

          <!-- Search -->
          <div class="flex-1 lg:block hidden">
            <app-search-bar />
          </div>

          <!-- Icons - Only show cart icon on mobile, all icons on desktop -->
          <div class="flex items-center justify-end gap-4">
            <!-- User icon - only visible on desktop -->
            <a routerLink="/user" class="icon-container hidden lg:block">
              <i class="pi pi-user"></i>
            </a>

            <!-- Wishlist icon - only visible on desktop -->
            <app-wishlist-icon class="hidden lg:block"></app-wishlist-icon>

            <!-- Cart icon - always visible -->
            <a routerLink="/cart" class="icon-container">
              <i class="pi pi-shopping-bag"></i>
              <span *ngIf="cartCount > 0" class="count-badge">{{ cartCount }}</span>
            </a>
          </div>
        </div>
        @if (showSearchbar()) {
        <div class="w-full -mt-[5px] lg:hidden block z-10 pb-2" [@layerAnimation]="'visible'"
          class="pointer-events-auto">
          <app-search-bar />
        </div>
        }
      </app-container>
    </div>

    <!-- Layer 3: Bottom - Navbar (using the new thirdLayerVisible signal) -->
    <div class="header-bottom-layer" [class.header-layer-hidden]="!thirdLayerVisible()"
      [@layerAnimation]="thirdLayerVisible() ? 'visible' : 'hidden'" (@layerAnimation.done)="onAnimationDone($event)"
      [ngClass]="{'pointer-events-auto': thirdLayerVisible(), 'pointer-events-none': !thirdLayerVisible()}">
      @defer (on idle) {
      <app-navbar-container [mainCategories]="mainCategories" [allCategories]="allCategories" />
      }
    </div>
  </div>
  }
</header>