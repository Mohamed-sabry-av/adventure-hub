<!-- Backdrop for options panel -->
<div
  *ngIf="state.isOpen"
  class="panel-backdrop"
  [class.active]="state.isOpen"
  (click)="closeSideOptions()">
</div>

<!-- Product Options Side Panel for Desktop -->
<div
  *ngIf="state.isOpen && !state.isMobile"
  class="options-side-panel"
  [@slideInFromRight]>
  <div class="options-panel-header">
    <div class="close-button" (click)="closeSideOptions()">
      <svg class="close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </div>
    <div class="product-info">
      <div class="product-image">
        <img [src]="getSelectedColorImage()" alt="Product image" />
      </div>
      <div class="product-details">
        <h4 class="product-name">{{ getProductName() }}</h4>
        <p class="product-sku" *ngIf="getSKU()">SKU: {{ getSKU() }}</p>
        <div class="product-price">
          <span class="current-price">{{ getCurrentPrice() }}</span>
          <span class="old-price" *ngIf="getOldPrice()">{{ getOldPrice() }}</span>
        </div>
        <p class="tax-info">VAT included</p>
        <a class="view-details-link" (click)="viewProductDetails()">View details</a>
      </div>
    </div>
  </div>

  <!-- Options Selection -->
  <div class="options-selection">
    <!-- Color Options -->
    <div class="option-section" *ngIf="state.colorOptions && state.colorOptions.length > 0">
      <h5 class="option-title">Color</h5>
      <div class="color-options">
        <div
          *ngFor="let color of state.colorOptions"
          class="color-swatch"
          [class.selected]="state.selectedColor === color.color"
          [class.out-of-stock]="!color.inStock">
          <div class="color-inner"
               [style.background-image]="color.image ? 'url(' + color.image + ')' : 'none'"
               (click)="selectColor(color.color, color.image)">
          </div>
          <span class="color-name">{{ color.color }}</span>
        </div>
      </div>
    </div>

    <!-- Size Options -->
    <div class="option-section" *ngIf="hasSizes()">
      <h5 class="option-title">Size</h5>
      <div class="size-options">
        <button
          *ngFor="let size of state.uniqueSizes"
          class="size-button"
          [class.selected]="state.selectedSize === size.size"
          [class.out-of-stock]="!size.inStock"
          [disabled]="!size.inStock"
          (click)="selectSize(size.size)">
          {{ size.size }}
        </button>
      </div>
    </div>
  </div>

  <!-- Quantity & Add to Cart -->
  <div class="add-to-cart-section">
    <div class="quantity-selector">
      <button
        class="quantity-btn decrease"
        (click)="decreaseQuantity()"
        [disabled]="quantity <= 1">
        <span>−</span>
      </button>
      <input
        type="number"
        class="quantity-input"
        [value]="quantity"
        min="1"
        (change)="onQuantityChange($event)">
      <button
        class="quantity-btn increase"
        (click)="increaseQuantity()">
        <span>+</span>
      </button>
    </div>
    <button
      class="add-to-cart-btn"
      [disabled]="isAddToCartDisabled()"
      [class.add-success]="addSuccess"
      (click)="onAddToCart()">
      ADD TO CART
    </button>
    <button class="buy-now-btn">BUY IT NOW</button>
  </div>
</div>

<!-- Mobile Bottom Sheet for Product Options -->
<div
  *ngIf="state.isOpen && state.isMobile"
  class="mobile-options-panel"
  [@slideUpFromBottom]>
  <div class="mobile-panel-header">
    <div class="pull-handle"></div>
    <div class="close-button" (click)="closeSideOptions()">
      <svg class="close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </div>
    <div class="product-info">
      <div class="product-image">
        <img [src]="getSelectedColorImage()" alt="Product image" />
      </div>
      <div class="product-details">
        <h4 class="product-name">{{ getProductName() }}</h4>
        <p class="product-sku" *ngIf="getSKU()">SKU: {{ getSKU() }}</p>
        <div class="product-price">
          <span class="current-price">{{ getCurrentPrice() }}</span>
          <span class="old-price" *ngIf="getOldPrice()">{{ getOldPrice() }}</span>
        </div>
        <p class="tax-info">VAT included</p>
        <a class="view-details-link" (click)="viewProductDetails()">View details</a>
      </div>
    </div>
  </div>

  <!-- Mobile Options Selection -->
  <div class="options-selection">
    <!-- Color Options -->
    <div class="option-section" *ngIf="state.colorOptions && state.colorOptions.length > 0">
      <h5 class="option-title">Color</h5>
      <div class="color-options">
        <div
          *ngFor="let color of state.colorOptions"
          class="color-swatch"
          [class.selected]="state.selectedColor === color.color"
          [class.out-of-stock]="!color.inStock">
          <div class="color-inner"
               [style.background-image]="color.image ? 'url(' + color.image + ')' : 'none'"
               (click)="selectColor(color.color, color.image)">
          </div>
          <span class="color-name">{{ color.color }}</span>
        </div>
      </div>
    </div>

    <!-- Size Options -->
    <div class="option-section" *ngIf="hasSizes()">
      <h5 class="option-title">Size</h5>
      <div class="size-options">
        <button
          *ngFor="let size of state.uniqueSizes"
          class="size-button"
          [class.selected]="state.selectedSize === size.size"
          [class.out-of-stock]="!size.inStock"
          [disabled]="!size.inStock"
          (click)="selectSize(size.size)">
          {{ size.size }}
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Quantity & Add to Cart -->
  <div class="add-to-cart-section">
    <div class="quantity-selector">
      <button
        class="quantity-btn decrease"
        (click)="decreaseQuantity()"
        [disabled]="quantity <= 1">
        <span>−</span>
      </button>
      <input
        type="number"
        class="quantity-input"
        [value]="quantity"
        min="1"
        (change)="onQuantityChange($event)">
      <button
        class="quantity-btn increase"
        (click)="increaseQuantity()">
        <span>+</span>
      </button>
    </div>
    <button
      class="add-to-cart-btn"
      [disabled]="isAddToCartDisabled()"
      [class.add-success]="addSuccess"
      (click)="onAddToCart()">
      ADD TO CART
    </button>
    <button class="buy-now-btn">BUY IT NOW</button>
  </div>
</div>
