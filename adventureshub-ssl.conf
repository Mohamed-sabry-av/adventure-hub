<VirtualHost *:443>
    ServerAdmin tarek@adventures-hub.com
    DocumentRoot /var/www/html
    ServerName adventures-hub.com
    ServerAlias www.adventures-hub.com

    SSLEngine on
    SSLCertificateFile /home/ssl/adventures-hub_com.crt
    SSLCertificateKeyFile /home/ssl/PRIVATEKEY.key
    SSLCertificateChainFile /home/ssl/adventures-hub_com.ca-bundle

    # تفعيل الوحدات المطلوبة
    ProxyRequests Off
    ProxyPreserveHost On

    # استبعاد مسارات WordPress من الـ Proxy إلا مسار api الخاص بالسيرفر
    ProxyPass /wp-admin !
    ProxyPass /wp-login.php !
    
    # استثناء مسارات محددة في wp-json
    ProxyPass /wp-json/api !
    ProxyPass /wp-json/custom/v1/cart !
    
    # السماح لباقي مسارات wp-json للوصول إلى WordPress API
    # ملاحظة: لا تستبعد /wp-json بالكامل لأن هذا يعطل WooCommerce API
    ProxyPass /wp-content !
    ProxyPass /wp-includes !
    
    # توجيه باقي الطلبات إلى Angular SSR
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    # توجيه خاص لطلبات API
    ProxyPass /api http://localhost:3000/api
    ProxyPassReverse /api http://localhost:3000/api

    # إعدادات مهمة جداً للـ Directory
    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # إعدادات CORS
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
